"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Utils={devVer:1,guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},getScreenHeight:function(e){return e.pixelRatio?Math.round(e.screenHeight*e.pixelRatio):e.screenHeight},getScreenWidth:function(e){return e.pixelRatio?Math.round(e.screenWidth*e.pixelRatio):e.screenWidth},getOS:function(e){if(e){let t=e.toLowerCase();return-1!=t.indexOf("android")?`${gioGlobal.platformConfig.name}-Android`:-1!=t.indexOf("ios")?`${gioGlobal.platformConfig.name}-iOS`:e}},getOSV:e=>`${gioGlobal.platformConfig.name} ${e}`,isEmpty:e=>{for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},compareVersion(e,t){e=e.split("."),t=t.split(".");const i=Math.max(e.length,t.length);for(;i>e.length;)e.push("0");for(;i>t.length;)t.push("0");for(let n=0;i>n;n++){const i=parseInt(e[n]),s=parseInt(t[n]);if(i>s)return 1;if(s>i)return-1}return 0},queryParse(e){let t={};if(e){let i=e.split("&");for(let e of i){let i=e.split("="),n=i.length;2==n?t[i[0]]=i[1]:1==n&&i[0]&&(t[i[0]]="")}}return t},queryStringify:e=>Object.keys(e).map(t=>`${t}=${e[t]}`).join("&"),clearShareQuery(e){if(!e)return;let t=Utils.queryParse(e);return delete t.shareId,delete t.contentId,delete t.contentType,Utils.queryStringify(t)}},initGlobal=e=>{Object.defineProperty(Object.prototype,"gioGlobal",{get:()=>"quickApp"===e?global.__proto__:"my"===e?$global:global,configurable:!1,enumerable:!1})},getDataByPath=(e,t)=>{if(!e)return e;const i=t.split(".");let n=e[i.shift()];for(let e=0,t=i.length;t>e;e++){const e=i.shift();if(!n)return n;n=n[e]}return n},getManualImpInfo=e=>{let t={eventId:void 0,properties:{}};try{if(e.hasOwnProperty("gioTrack")&&"object"==typeof e.gioTrack)return t.eventId=e.gioTrack.name,t.properties=e.gioTrack.properties,t;if(!e.gioImpTrack)return t;t.eventId=e.gioImpTrack;const i=/^gioTrack(.+)/,n=/^\w+$/;for(let s in e){let o,r=s.match(i);if(r&&("track"===(o=r[1].toLowerCase())?t.eventId=e[s]:t.properties[o]=e[s]),!n.test(t.eventId)||10>parseInt(t.eventId[0]))throw t.eventId=null,Error()}}catch(e){console.warn("半打点IMP格式不正确, 事件名只能包含数字，字母和下划线，且不以数字开头, 请参考文档")}return t},stringifyVar=e=>{let t=e;for(let i in e)"string"!=typeof e[i]&&(t[i]=JSON.stringify(e[i]));return t},isString=e=>e&&"string"==typeof e&&e.constructor===String,getItem=e=>e&&"object"==typeof e&&e.id&&e.key?{id:"string"==typeof e.id?e.id:JSON.stringify(e.id),key:"string"==typeof e.key?e.key:JSON.stringify(e.key)}:null,defineInfoHook=e=>(function(){try{let t="function"!=typeof e?{}:e.apply(this,arguments);return t instanceof Promise?t:Promise.resolve(t)}catch(e){return Promise.reject(e)}}),normalPath=e=>/^\//.test(e)?e:"/"+e,sdkVersion="3.5.5",platformConfig={wx:{name:"Weixin",path:"./weixin"},qq:{name:"QQ",path:"./qq"},my:{name:"Alipay",path:"./alipay"},swan:{name:"Baidu",path:"./baidu"},tt:{name:"Bytedance",path:"./bytedance"},quickApp:{name:"Quickapp",path:"./quickApp"},frame:{name:"Frame",path:"./multipleFrame"}},Config=Object.assign({},platformConfig.wx,{platform:"MinP",scnPrefix:"",appHandlers:["onShow","onHide","onError"],pageHandlers:["onLoad","onShow","onShareAppMessage","onShareTimeline","onTabItemTap","onHide","onUnload"],actionEventTypes:["onclick","tap","longpress","blur","change","submit","confirm","getuserinfo","getphonenumber","contact"],originalApp:App,originalPage:Page,originalComponent:Component,originalBehavior:Behavior,canHook:!0,hooks:{App:!0,Page:!0,Component:!0,Behavior:!0},lisiteners:{app:{appShow:"onShow",appClose:"onHide",appError:"onError"},page:{pageLoad:"onLoad",pageShow:"onShow",pageHide:"onHide",pageClose:"onUnload",tabTap:"onTabItemTap",shareApp:"onShareAppMessage",shareTime:"onShareTimeline"},actions:{click:["onclick","tap","longpress","getuserinfo","getphonenumber","contact"],change:["blur","change","confirm"],submit:["submit"]}}});var platformConfig$1=Object.assign({},Config,{sdkVer:"3.5.5"});const proxyVue=(e,t)=>{void 0!==e.mixin&&e.mixin({created:function(){if(!this.$options.methods)return;const e=Object.keys(this.$options.methods);for(let t of Object.keys(this))0>e.indexOf(t)||"function"!=typeof this[t]||(Object.defineProperty(this[t],"proxiedName",{value:t}),Object.defineProperty(this[t],"isProxied",{value:!0}))},beforeMount:function(){let e=this.$root;e.$mp&&"page"===e.$mp.mpType?e.$mp.page&&(t.vueRootVMs[e.$mp.page.route]=e):"page"===e.mpType&&"page"===this.mpType&&e.$mp.page&&(t.vueRootVMs[e.$mp.page.route||e.$mp.page.is]=e,-1!==["wx","qq","tt"].indexOf(gioGlobal.gio__platform)&&VdsInstrumentAgent.instrumentPageComponent(e.$mp.page))}}),console.log("prox",t.vueRootVMs)},proxyTaro=(e,t,i)=>{const n=e.createComponent,s=i.usePlugin;if(n&&(e.createComponent=function(e,i){let o=e;for(;o&&o.prototype;){const i=Object.keys(Object.getOwnPropertyDescriptors(o.prototype)||{});for(let n=0;i.length>n;n++)if(i[n].startsWith("func__")){const s=o.name,r=i[n].slice(6);t.taroRootVMs[i[n]]=s+"_"+(""+e.prototype[i[n]]).match(/this\.__triggerPropsFn\("(.+)",/)[1]+"_"+r}o=Object.getPrototypeOf(o)}const r=n(e,i),a=-1!==["MinP","qq"].indexOf(platformConfig$1.platform),g=a?r&&r.methods:r;return s?i&&VdsInstrumentAgent.instrumentPageComponent(g):i&&a&&VdsInstrumentAgent.instrumentPageComponent(g),r}),s&&e.createApp){const t=e.createApp;e.createApp=function(e){let i=t(e);return i._growing_app_=!0,VdsInstrumentAgent.instrument(i),i}}},needHookTaroAction=e=>{let t;return!!(document&&(t=document.getElementById((e.currentTarget||e.target).id))&&t.__handlers)&&Array.from(t.__handlers[e.type]||[]).some(e=>!e._stop)},proxyCml=(e,t)=>{const i=e.createApp,n=e.createComponent;e.createApp=function(e){return e._growing_app_=!0,i(VdsInstrumentAgent.instrument(e))},e.createComponent=function(e){return n(e.data&&e.data.isComponent?Object.assign({},e,{methods:VdsInstrumentAgent.instrument(e.methods)}):e)}},proxyWepy=(e,t,i)=>{const n=e.page,s=function(e){const n=Object.keys(e);for(let s=0;n.length>s;s++){const o=Object.keys(e[n[s]]);for(let r=0;o.length>r;r++)if("function"==typeof e[n[s]][o[r]]){const a=(""+e[n[s]][o[r]]).match(/_vm\.(.+)\(.*\)/);a&&a[1]&&(t.wepyRootVMs[n[s]]||(t.wepyRootVMs[n[s]]={}),t.wepyRootVMs[n[s]][o[r]]=a[1]),i.usePlugin&&(e[n[s]][o[r]]=VdsInstrumentAgent.hook("_proxy",e[n[s]][o[r]]))}}};e.page=function(e,t){return t.handlers&&s(t.handlers),VdsInstrumentAgent.instrumentPageComponent(e),n(e,t)};const o=e.component;if(e.component=function(e,t){return t.handlers&&s(t.handlers),o(e,t)},i.usePlugin){const t=e.app;e.app=function(e,i){return e._growing_app_=!0,t(VdsInstrumentAgent.instrument(e),i)}}};let setShareResult=(e,t,i)=>{let n=VdsInstrumentAgent.observer.growingio;if(n&&n.vdsConfig.followShare){i||(i={}),i.title||(i.title=VdsInstrumentAgent.observer.info.getPageTitle(e));let s=e=>{let t=Utils.queryParse(e);return VdsInstrumentAgent.observer.cdpObserver&&(t.shareId=t.shareId||Utils.guid(),t.shareType="0",t.contentId=t.contentId||t.title||i.title,t.contentType=t.contentType||"1"),t.suid=n.info.uid,i.queryObj=t,Utils.queryStringify(t)},o=VdsInstrumentAgent.observer.currentPage;if(t)i.query=s(i.query||o.cleanQuery);else{let e=i.path||o.path,t=o.cleanQuery;if(-1!=e.indexOf("?")){let i=e.split("?");e=i[0],t=i[1]}i.path=normalPath(e+"?"+s(t))}}return i};const VdsInstrumentAgent={defaultPageCallbacks:{},defaultAppCallbacks:{},appHandlers:null,pageHandlers:null,actionEventTypes:null,originalPage:null,originalApp:null,originalComponent:null,originalBehavior:null,observer:null,hook:function(e,t){return function(){let i,n=arguments?arguments[0]:void 0;if(n&&(n.currentTarget||n.target)&&-1!=VdsInstrumentAgent.actionEventTypes.indexOf(n.type))if(gioGlobal.vdsConfig.taro&&!gioGlobal.vdsConfig.taro.createApp)needHookTaroAction(n)&&VdsInstrumentAgent.observer.actionListener(n,e);else try{VdsInstrumentAgent.observer.actionListener(n,e)}catch(e){console.error(e)}const s=gioGlobal.platformConfig.lisiteners.app,o=gioGlobal.platformConfig.lisiteners.page;if(this._growing_app_&&e!==s.appShow?i=t.apply(this,arguments):this._growing_page_&&-1===[o.pageShow,o.pageClose,o.pageLoad,o.pageHide,o.tabTap].indexOf(e)?i=t.apply(this,arguments):this._growing_app_||this._growing_page_||(i=t.apply(this,arguments)),this._growing_app_){if(!VdsInstrumentAgent.observer.cdpObserver&&-1!==VdsInstrumentAgent.appHandlers.indexOf(e))try{VdsInstrumentAgent.defaultAppCallbacks[e].apply(this,arguments)}catch(e){console.error(e)}e===s.appShow&&(i=t.apply(this,arguments))}if(this._growing_page_&&-1!==VdsInstrumentAgent.pageHandlers.indexOf(e)){o.shareTime==e?i=setShareResult(this,!0,i):o.shareApp==e&&(i=setShareResult(this,!1,i));let n=Array.prototype.slice.call(arguments);i&&n.push(i);try{VdsInstrumentAgent.defaultPageCallbacks[e].apply(this,n)}catch(e){console.error(e)}-1!==[o.pageShow,o.pageClose,o.pageLoad,o.pageHide,o.tabTap].indexOf(e)&&(i=t.apply(this,arguments))}return i}},hookComponent:function(e,t){return function(){let i,n=arguments?arguments[0]:void 0;if(!VdsInstrumentAgent.observer.cdpObserver&&n&&(n.currentTarget||n.target)&&-1!=VdsInstrumentAgent.actionEventTypes.indexOf(n.type))try{VdsInstrumentAgent.observer.actionListener(n,e)}catch(e){console.error(e)}return i=t.apply(this,arguments)}},instrument:function(e){let t={};const i=i=>{t[i]="function"==typeof e[i]&&"constructor"!==i?this.hook(i,e[i]):e[i]};return Object.getOwnPropertyNames(e).forEach(i),e.__proto__!==Object.prototype&&Object.getOwnPropertyNames(e.__proto__).forEach(i),t._growing_app_&&VdsInstrumentAgent.appHandlers.map(function(e){t[e]||(t[e]=VdsInstrumentAgent.defaultAppCallbacks[e])}),t._growing_page_&&VdsInstrumentAgent.pageHandlers.map(function(e){t[e]||e===gioGlobal.platformConfig.lisiteners.page.shareApp||e===gioGlobal.platformConfig.lisiteners.page.shareTime||(t[e]=VdsInstrumentAgent.defaultPageCallbacks[e])}),t},instrumentPageComponent:function(e){if(e)return VdsInstrumentAgent.pageHandlers.map(function(t){if("function"==typeof e[t]){const i=e[t];e[t]=function(){let e=i.apply(this,arguments),n=Array.prototype.slice.call(arguments);return e&&n.push(e),t===gioGlobal.platformConfig.lisiteners.page.shareTime?e=setShareResult(this,!0,e):t===gioGlobal.platformConfig.lisiteners.page.shareApp&&(e=setShareResult(this,!1,e)),VdsInstrumentAgent.observer.pageListener(this,t,n),e}}else t!==gioGlobal.platformConfig.lisiteners.page.shareApp&&t!==gioGlobal.platformConfig.lisiteners.page.shareTime&&(e[t]=function(){VdsInstrumentAgent.observer.pageListener(this,t,arguments)})}),e},instrumentComponent:function(e){if(e.methods){let t=e.methods;for(let i in t)"function"==typeof t[i]&&(e.methods[i]=this.hookComponent(i,t[i]))}return e},GrowingPage:function(e){return e._growing_page_=!0,VdsInstrumentAgent.originalPage(VdsInstrumentAgent.instrument(e))},GrowingComponent:function(e){return VdsInstrumentAgent.originalComponent(VdsInstrumentAgent.instrumentComponent(e))},GrowingBehavior:function(e){return VdsInstrumentAgent.originalBehavior(VdsInstrumentAgent.instrumentComponent(e))},GrowingApp:function(e){return e._growing_app_=!0,VdsInstrumentAgent.originalApp(VdsInstrumentAgent.instrument(e))},initPlatformInfo(e){VdsInstrumentAgent.appHandlers=e.appHandlers,VdsInstrumentAgent.pageHandlers=e.pageHandlers,VdsInstrumentAgent.actionEventTypes=e.actionEventTypes,VdsInstrumentAgent.originalApp=e.originalApp,VdsInstrumentAgent.originalPage=e.originalPage,VdsInstrumentAgent.originalComponent=e.originalComponent,VdsInstrumentAgent.originalBehavior=e.originalBehavior},initInstrument:function(e){if(VdsInstrumentAgent.initPlatformInfo(gioGlobal.platformConfig),VdsInstrumentAgent.observer=e,VdsInstrumentAgent.pageHandlers.forEach(function(e){VdsInstrumentAgent.defaultPageCallbacks[e]=function(){VdsInstrumentAgent.observer.pageListener(this,e,arguments)}}),VdsInstrumentAgent.observer.cdpObserver||VdsInstrumentAgent.appHandlers.forEach(function(e){VdsInstrumentAgent.defaultAppCallbacks[e]=function(){VdsInstrumentAgent.observer.appListener(this,e,arguments)}}),gioGlobal.platformConfig.canHook){const e=gioGlobal.platformConfig.hooks;if(e.App&&!gioGlobal.growingAppInited){if(App=function(){return VdsInstrumentAgent.GrowingApp(arguments[0])},"swan"===gioGlobal.gio__platform)for(const e in VdsInstrumentAgent.originalApp)App[e]=VdsInstrumentAgent.originalApp[e];gioGlobal.growingAppInited=!0}if(e.Page&&!gioGlobal.growingPageInited){if(Page=function(){return VdsInstrumentAgent.GrowingPage(arguments[0])},"swan"===gioGlobal.gio__platform)for(const e in VdsInstrumentAgent.originalPage)Page[e]=VdsInstrumentAgent.originalPage[e];gioGlobal.growingPageInited=!0}e.Component&&!gioGlobal.growingComponentInited&&(Component=function(){return VdsInstrumentAgent.GrowingComponent(arguments[0])},gioGlobal.growingComponentInited=!0),e.Behavior&&!gioGlobal.growingBehaviorInited&&(Behavior=function(){return VdsInstrumentAgent.GrowingBehavior(arguments[0])},gioGlobal.growingBehaviorInited=!0)}gioGlobal.GioPage=VdsInstrumentAgent.GrowingPage,gioGlobal.GioApp=VdsInstrumentAgent.GrowingApp,gioGlobal.GioComponent=VdsInstrumentAgent.GrowingComponent,gioGlobal.GioBehavior=VdsInstrumentAgent.GrowingBehavior,gioGlobal.trackApp=function(){const e=arguments[0];return e._growing_app_=!0,VdsInstrumentAgent.instrument(e)},gioGlobal.trackPage=function(){const e=arguments[0];return e._growing_page_=!0,VdsInstrumentAgent.instrument(e)},gioGlobal.trackComponent=function(){return VdsInstrumentAgent.instrument(arguments[0])},gioGlobal.trackBehavior=function(){return VdsInstrumentAgent.instrument(arguments[0])}}};if(!Object.hasOwnProperty("getOwnPropertyDescriptors")){let e;e="object"==typeof Reflect&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:"function"==typeof Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Object.defineProperty(Object,"getOwnPropertyDescriptors",{configurable:!0,writable:!0,value:function(t){return e(t).reduce((e,i)=>Object.defineProperty(e,i,{configurable:!0,enumerable:!0,writable:!0,value:Object.getOwnPropertyDescriptor(t,i)}),{})}})}class BaseObserver{constructor(e){this.growingio=e,this.esid=0,this.info=e.info}setUserAttributes(e){throw Error("this a interface function")}setUserId(e){throw Error("this a interface function")}clearUserId(){throw Error("this a interface function")}sendVisitEvent(e,t){throw Error("this a interface function")}track(e,t){throw Error("this a interface function")}_sendEvent(e){throw Error("this a interface function")}}function validVar(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)&&Object.keys(e).length>0}function EventEmitter(){}var proto=EventEmitter.prototype,originalGlobalValue=exports.EventEmitter;function indexOfListener(e,t){for(var i=e.length;i--;)if(e[i].listener===t)return i;return-1}function alias(e){return function(){return this[e].apply(this,arguments)}}function isValidListener(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&isValidListener(e.listener)}proto.getListeners=function(e){var t,i,n=this._getEvents();if(e instanceof RegExp)for(i in t={},n)n.hasOwnProperty(i)&&e.test(i)&&(t[i]=n[i]);else t=n[e]||(n[e]=[]);return t},proto.flattenListeners=function(e){var t,i=[];for(t=0;e.length>t;t+=1)i.push(e[t].listener);return i},proto.getListenersAsObject=function(e){var t,i=this.getListeners(e);return i instanceof Array&&((t={})[e]=i),t||i},proto.addListener=function(e,t){if(!isValidListener(t))throw new TypeError("listener must be a function");var i,n=this.getListenersAsObject(e),s="object"==typeof t;for(i in n)n.hasOwnProperty(i)&&-1===indexOfListener(n[i],t)&&n[i].push(s?t:{listener:t,once:!1});return this},proto.on=alias("addListener"),proto.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},proto.once=alias("addOnceListener"),proto.defineEvent=function(e){return this.getListeners(e),this},proto.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},proto.removeListener=function(e,t){var i,n,s=this.getListenersAsObject(e);for(n in s)s.hasOwnProperty(n)&&-1!==(i=indexOfListener(s[n],t))&&s[n].splice(i,1);return this},proto.off=alias("removeListener"),proto.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},proto.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},proto.manipulateListeners=function(e,t,i){var n,s,o=e?this.removeListener:this.addListener,r=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=i.length;n--;)o.call(this,t,i[n]);else for(n in t)t.hasOwnProperty(n)&&(s=t[n])&&("function"==typeof s?o.call(this,n,s):r.call(this,n,s));return this},proto.removeEvent=function(e){var t,i=typeof e,n=this._getEvents();if("string"===i)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},proto.removeAllListeners=alias("removeEvent"),proto.emitEvent=function(e,t){var i,n,s,o,r=this.getListenersAsObject(e);for(o in r)if(r.hasOwnProperty(o))for(i=r[o].slice(0),s=0;i.length>s;s++)!0===(n=i[s]).once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},proto.trigger=alias("emitEvent"),proto.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},proto.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},proto._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},proto._getEvents=function(){return this._events||(this._events={})},EventEmitter.noConflict=function(){return exports.EventEmitter=originalGlobalValue,EventEmitter};const gioEmitter=new EventEmitter;class Page$1{constructor(){this.queries={},this.pvar={}}touch(e){this.path=e.route||e.__route__,this.time=Date.now(),this.query=this.queries[e.route]?this.queries[e.route]:void 0,this.cleanQuery=Utils.clearShareQuery(this.query)}addQuery(e,t){this.queries[e.route]=t?this._getQuery(t):null}_getQuery(e){return Object.keys(e||{}).filter(e=>"wxShoppingListScene"!==e).map(t=>`${t}=${e[t]}`).join("&")}touchRelatedPvarData(e){const t=`${e.p}?${e.q}`;this.pvar[t]?this.pvar[t].push(e):this.pvar[t]=[e]}}class Observer extends BaseObserver{constructor(e){super(e),this.growingio=e,this.info=e.info,this.currentPage=new Page$1,this._sessionId=null,this.uploadingMessages=[],this.isGettingUid=!1,this.lastSentTime=null,this.lastScene=null,this.keepAlive=3e5,this.scene=void 0,this.currentScene=void 0,this.esid=0===this.info.esid?1:this.info.esid,this.uid=this.info.uid,this.gioId=this.info.gioId,this.path=null,this.query=null,this.visitEvent={context:void 0},this.isPauseSession=!1,this.lastPageEvent=null,this.cdpObserver=!0}pageListener(e,t,i){const n=gioGlobal.platformConfig.lisiteners.page;if(e.route||this.info.getPagePath(e),this.growingio.vdsConfig.debug&&console.log("Page.",e.route,"#",t,Date.now()),t===n.pageShow){const t=getDataByPath(e,"$page.query");Utils.isEmpty(t)||"quickApp"!==gioGlobal.gio__platform||this.currentPage.addQuery(e,t),this.isPauseSession?this.isPauseSession=!1:(this.currentPage.touch(e),setTimeout(()=>{this.sendPage(e)},300))}else if(t===n.pageLoad){const t=i[0];Utils.isEmpty(t)||"quickApp"===gioGlobal.gio__platform||this.currentPage.addQuery(e,t)}else if(t===n.shareApp||t===n.shareTime){let n=null,s=null;2>i.length?1===i.length&&(i[0].from?n=i[0]:i[0].title&&(s=i[0])):(n=i[0],s=i[1]),this.isPauseSession=!0,this.sendPageShare(e,n,s,t)}}actionListener(e,t){"getuserinfo"===e.type&&e.detail&&this.sendAuthorizeInfo(e.detail.userInfo)}get sessionId(){return null===this._sessionId&&(this._sessionId=Utils.guid()),this._sessionId}getUserId(){return this.info.userId||this.info.gioId}setUserId(e){if(null==e)return;const t=e+"",i=this.growingio.info.gioId;t&&100>t.length&&(this.info.userId=t,this.info.gioId=t,gioEmitter.emitEvent("setCs1",[t]),i&&i!=t&&this.sendVisitEvent(this.growingio.vdsConfig.getLocationType))}clearUserId(){this.info.userId=null,gioEmitter.emitEvent("clearCs1")}sendPage(e){let t=this.lastPageEvent?this.lastPageEvent.context.page.path:void 0,i={page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.currentPage.path,query:this.currentPage.query,title:this.info.getPageTitle(e)},referrer:{page:t||`scn:${this.currentScene?this.currentScene:"NA"}`}},n={type:"PAGE",sendTime:this.currentPage.time,context:Object.assign({},this.visitEvent.context,i),session:this.sessionId,version:this.growingio.vdsConfig.sdkVer};this._sendEvent(n),this.lastPageEvent=n}setUserAttributes(e){if(validVar(e)){const t={attributes:stringifyVar(e)};this._sendEvent(t)}}track(e,t,i){if("string"!=typeof e||null===e||void 0===e||0===e.length||!e.match(/^\w+$/)||10>parseInt(e[0]))return void console.warn("埋点格式不正确, 事件名只能包含数字，字母和下划线，且不以数字开头, 请参考文档");const n=this.info.getCurrentPage();let s={type:"CUSTOM_EVENT",eventKey:e,context:{page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.path||this.info.getPagePath(),query:this.currentPage.query||this.currentPage._getQuery(this.query),title:this.info.getPageTitle(n)},referrer:{from:`scn:${this.currentScene?this.currentScene:"NA"}`},network:{type:void 0}},session:this.sessionId};validVar(t)&&(s.attributes=t);const o=getItem(i);o&&(s.item=o),this.info.getNetworkType().then(e=>{e&&(s.context.network.type=e.networkType),this._sendEvent(s)})}sendCloseEvent(){if(this.isPauseSession)return;let e=Object.assign({},this.visitEvent,{type:"VISIT_CLOSE"});this._sendEvent(e)}sendPageShare(e,t,i,n="onShareAppMessage"){if(!this.growingio.vdsConfig.followShare)return;let s={type:"CUSTOM_EVENT",eventKey:n,attributes:{from:t?t.from:void 0,target:t&&t.target?t.target.id:void 0},context:{page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.currentPage.path,query:this.currentPage.query}},session:this.sessionId,version:this.growingio.vdsConfig.sdkVer};i&&(s.attributes=Object.assign({},s.attributes,{title:i.title,path:i.path?decodeURI(i.path):void 0,query:i.query?decodeURI(i.query):void 0},i.queryObj)),this._sendEvent(s)}sendShareAppOpen(e){if(this.growingio.vdsConfig.followShare&&!this.isPauseSession&&e&&e.query&&e.query.shareId){let t=t=>{let i={type:"CUSTOM_EVENT",eventKey:"shareAppMessageOpen",attributes:Object.assign({},e.query,{scene:e.scene,groupId:t.groupId}),context:{page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.currentPage.path,query:this.currentPage.query}},session:this.sessionId,version:this.growingio.vdsConfig.sdkVer};this._sendEvent(i)};this.growingio.vdsConfig.getInfoHook.call(null,e).then(e=>{t(e||{})}).catch(e=>{t({}),this.growingio.vdsConfig.debug&&console.error("ShareAppOpen.",e,Date.now())})}}sendAuthorizeInfo(e){if(this.growingio.vdsConfig.followShare&&validVar(e)){let t={type:"CUSTOM_EVENT",eventKey:"onAuthorizeInfo",attributes:e,context:{page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.currentPage.path,query:this.currentPage.query}},session:this.sessionId,version:this.growingio.vdsConfig.sdkVer};this._sendEvent(t)}}identify(e,t){void 0!==e&&0!==e.length&&this.growingio.login(e)}sendVisitEvent(e){if(this.isPauseSession)return;let t=Date.now();if(this.keepAlive>t-this.lastSentTime){if(this.lastScene===this.currentScene)return;this._sessionId=null}else this._sessionId=null;const i=this.info.getCurrentPage();let n=this;const s=this.info.getSystemInfo(),o=this.info.getNetworkType();Promise.all([s,o]).then(([t,s])=>{const o=t||{};let r={type:"VISIT",version:this.growingio.vdsConfig.sdkVer,context:{app:{id:this.growingio.vdsConfig.appId,version:this.growingio.vdsConfig.appVer,channel:`scn:${this.currentScene?this.currentScene:"NA"}`},screen:{width:Utils.getScreenWidth(o),height:Utils.getScreenHeight(o)},device:{brand:o.brand,model:o.model,platform:platformConfig$1.platform},operationSystem:{name:Utils.getOS(o.platform),version:platformConfig$1.name+" "+o.version},page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.path||this.info.getPagePath(),query:this.currentPage._getQuery(this.query),title:this.info.getPageTitle(i)},locale:{language:o.language},network:{type:void 0},location:{latitude:void 0,longitude:void 0}},session:this.sessionId};n.visitEvent=r,s&&(r.context.network.type=s.networkType,this._sendEvent(r),this.growingio.vdsConfig.getLocation.autoGet&&(e&&-1!==["wgs84","gcj02",0,1,2].indexOf(e)||(e="my"===gioGlobal.gio__platform?0:"wgs84"),this.info.getLocation(e).then(e=>{if(e){let t=JSON.parse(JSON.stringify(r));t.context.location.latitude=e.latitude,t.context.location.longitude=e.longitude,this._sendEvent(t),n.visitEvent=t}})))})}setPlatformProfile(e,t){let i;switch(platformConfig$1.platform){case"MinP":i={wechat:e};break;case"alip":i={alip:e};break;case"bytedance":i={bytedance:e}}const n=validVar(t)?stringifyVar(t):void 0;this._sendEvent({profile:i,attributes:n})}_sendEvent(e){if(this.growingio.vdsConfig.dataCollect){if(e.projectKey=this.growingio.vdsConfig.projectId,e.dataSourceId=this.growingio.vdsConfig.dataSourceId,e.anonymousId=this.info.uid,e.timestamp=+Date.now(),this.lastSentTime=+Date.now(),this.lastScene=this.currentScene,e.esid=this.esid,this.info.userId&&(e.userId=this.info.userId),this.info.gioId&&(e.gioId=this.info.gioId),this.uid&&this.gioId)this.growingio.upload(e);else if(this.isGettingUid)this.uploadingMessages.push(e);else{this.isGettingUid=!0;const t=this.info.getStorage(this.info.uidKey),i=this.info.getStorage(this.info.gioIdKey);Promise.all([t,i]).then(([t,i])=>{let n=this.info.uid||t||Utils.guid();for(i&&(this.info.gioId=this.info.gioId||i,e.gioId=e.gioId||i),this.info.uid=n,e.anonymousId=n,this.isGettingUid=!1,this.growingio.upload(e);0!==this.uploadingMessages.length;){let e=this.uploadingMessages.shift();i&&(e.gioId=e.gioId||i),e.anonymousId=e.anonymousId||n,this.growingio.upload(e)}})}this.esid++,this.growingio.vdsConfig.canHide&&(this.info.esid=this.esid)}}}class Uploader{constructor(e){this.growingio=e,this.messageQueue=[],this.failedQueue={data:[],type:""},this.uploadingQueue=[],this.vstQueue=[],this.pageQueue=[],this.cstmQueue=[],this.userQueue=[],this.uploadTimer=null,this.vstTimer=null,this.pageTimer=null,this.userTimer=null,this.cstmTimer=null,this.projectId=this.growingio.vdsConfig.projectId,this.appId=this.growingio.vdsConfig.appId}upload(e){const t=this.growingio.vdsConfig.host,i=this.growingio.vdsConfig.scheme,n={CLOSE:`${i}${t}/projects/${this.projectId}/collect/vst`,VISIT:`${i}${t}/projects/${this.projectId}/collect/vst`,USER_EVENT:`${i}${t}/projects/${this.projectId}/collect/user`,CUSTOM_EVENT:`${i}${t}/projects/${this.projectId}/collect/cstm`,PAGE:`${i}${t}/projects/${this.projectId}/collect/page`};switch(e.type?e.type:"USER_EVENT"){case"USER_EVENT":this.userQueue.push(e);break;case"CUSTOM_EVENT":this.cstmQueue.push(e);break;case"PAGE":this.pageQueue.push(e);break;default:this.vstQueue.push(e)}switch(this.failedQueue.type){case"USER_EVENT":this.userQueue.concat(this.failedQueue.data);break;case"CUSTOM_EVENT":this.cstmQueue.concat(this.failedQueue.data);break;case"PAGE":this.pageQueue.concat(this.failedQueue.data);break;default:this.vstQueue.concat(this.failedQueue.data)}0!==this.vstQueue.length&&this.timerFlush("VISIT",n.VISIT),0!==this.pageQueue.length&&this.timerFlush("PAGE",n.PAGE),0!==this.userQueue.length&&this.timerFlush("USER_EVENT",n.USER_EVENT),0!==this.cstmQueue.length&&this.timerFlush("CUSTOM_EVENT",n.CUSTOM_EVENT)}timerFlush(e,t){switch(e){case"VISIT":!this.vstTimer&&(this.vstTimer=setTimeout(()=>{this._flush(e,t),this.vstTimer=null},1e3));break;case"PAGE":!this.pageTimer&&(this.pageTimer=setTimeout(()=>{this._flush(e,t),this.pageTimer=null},1e3));break;case"CUSTOM_EVENT":!this.cstmTimer&&(this.cstmTimer=setTimeout(()=>{this._flush(e,t),this.cstmTimer=null},1e3));break;case"USER_EVENT":!this.userTimer&&(this.userTimer=setTimeout(()=>{this._flush(e,t),this.userTimer=null},1e3))}}_flush(e,t){switch(e){case"USER_EVENT":this.uploadingQueue=this.userQueue.slice(),this.userQueue=[];break;case"CUSTOM_EVENT":this.uploadingQueue=this.cstmQueue.slice(),this.cstmQueue=[];break;case"PAGE":this.uploadingQueue=this.pageQueue.slice(),this.pageQueue=[];break;default:this.uploadingQueue=this.vstQueue.slice(),this.vstQueue=[]}this.growingio.info.request({url:`${t}?stm=${Date.now()}`,header:{"content-type":"application/json"},method:"POST",data:this.uploadingQueue,success:()=>{this.messageQueue.length>0&&this._flush(this.uploadingQueue,t)},fail:t=>{204!==t.status&&(this.failedQueue={data:this.uploadingQueue,type:e})}})}}class Info{constructor(e){this.growing=e,this._uid=void 0,this._esid=void 0,this._gioId=void 0,this._userId=void 0,this._systemInfo=null,this.uidKey="_growing_uid_",this.esidKey="_growing_esid_",this.gioIdKey="_growing_gioId_",this.userIdKey="_growing_userId_",this.platform=gioGlobal.platformConfig.platform,this.sdkVer=gioGlobal.platformConfig.sdkVer,this.scnPrefix=gioGlobal.platformConfig.scnPrefix,"quickapp"!==gioGlobal.platformConfig.platform&&this.initUserInfo()}set esid(e){this._esid=e,this.setStorage(this.esidKey,this._esid)}get esid(){return this._esid}set uid(e){this._uid=e,this.setStorage(this.uidKey,this._uid)}get uid(){return this._uid}set gioId(e){this._gioId=e,this.setStorage(this.gioIdKey,this._gioId)}get userId(){return this._userId}set userId(e){this._userId=e,this.setStorage(this.userIdKey,this._userId)}get gioId(){return this._gioId}get systemInfo(){return this._systemInfo}initUserInfo(){this.uid=this.getStorageSync(this.uidKey),this.esid=+this.getStorageSync(this.esidKey),this.gioId=this.getStorageSync(this.gioIdKey),this._userId=this.getStorageSync(this.userIdKey)}syncStorage(){this.getStorage(this.uidKey).then(e=>{e||this.setStorage(this.uidKey,this._uid)})}getAppId(){throw Error("this a interface function")}getAppSource(){throw Error("this a interface function")}getPageTitle(e){throw Error("this a interface function")}getPagePath(e){throw Error("this a interface function")}getStorage(e){throw Error("this a interface function")}getStorageSync(e){throw Error("this a interface function")}setStorage(e,t){throw Error("this a interface function")}getSystemInfo(){throw Error("this a interface function")}getNetworkType(){throw Error("this a interface function")}getLocation(e){throw Error("this a interface function")}request({url:e,header:t,method:i,data:n,timeout:s,success:o,fail:r}){throw Error("this a interface function")}collectImp(e,t=null){throw Error("this a interface function")}initShareAppMessage(e){throw Error("this a interface function")}getCurrentPage(){throw Error("this a interface function")}getQuery(){throw Error("this a interface function")}getReferrer(){throw Error("this a interface function")}getInitPath(){throw Error("this a interface function")}onAppShow(e){throw Error("this is a interdace function")}onAppHide(e){throw Error("this is a interface function")}timeoutAbort(e,t){e&&e.abort&&setTimeout(()=>{e.abort()},(t||1e4)+10)}}class Weixin extends Info{constructor(e){super(e),this.growingio=e}getAppId(){this._systemInfo||(this._systemInfo=wx.getSystemInfoSync());let e=void 0;return 0>Utils.compareVersion(this._systemInfo.SDKVersion,"2.2.2")||(e=wx.getAccountInfoSync().miniProgram.appId),e}getPagePath(){return this.getCurrentPage().route}getCurrentPage(){const e=getCurrentPages();return e[e.length-1]}getPageTitle(e){let t="";try{if(e.data.title&&e.data.title.length>0&&(t=Array.isArray(e.data.title)?e.data.title.join(" "):e.data.title),0===t.length&&__wxConfig){if(__wxConfig.tabBar){let i=__wxConfig.tabBar.list.find(t=>t.pathPath==e.route||t.pagePath==`${e.route}.html`);i&&i.text&&(t=i.text)}if(0==t.length){let i=__wxConfig.page[e.route]||__wxConfig.page[`${e.route}.html`];t=i?i.window.navigationBarTitleText:__wxConfig.global.window.navigationBarTitleText}}}catch(e){return""}return t}getStorage(e){return new Promise(t=>{wx.getStorage({key:e,success:e=>t(e.data),fail:()=>t("")})})}getStorageSync(e){return wx.getStorageSync(e)}setStorage(e,t){wx.setStorage({key:e,data:t})}getSystemInfo(){return new Promise(e=>{wx.getSystemInfo({success:t=>{this._systemInfo=t,e(t)},fail:()=>e(null)})})}getNetworkType(){return new Promise(e=>{wx.getNetworkType({success:t=>e(t),fail:()=>e(null)})})}getSetting(){return new Promise(e=>{wx.getSetting({success:e,fail:e})})}getLocation(e){return new Promise(t=>{wx.getLocation({type:e,success:e=>t(e),fail:()=>t(null)})})}request({url:e,header:t,method:i,data:n,timeout:s,success:o,fail:r,complete:a}){let g=wx.request({url:e,header:t,method:i,data:n,timeout:s,success:o,fail:r,complete:a});return super.timeoutAbort(g,s),g}getImageInfo(e){return wx.getImageInfo(e)}collectImp(e,t=null){let i=null;this.growingio.vdsConfig.vue&&(e=e.$mp.page),this.growingio.vdsConfig.taro&&(e=e.$scope);let n={};this.growingio._observer&&this.growingio._observer.disconnect(),this.growingio._observer=e.isComponent?e.createIntersectionObserver({observeAll:!0}):wx.createIntersectionObserver(e,{observeAll:!0}),(i=t?this.growingio._observer.relativeTo(t):this.growingio._observer.relativeToViewport()).observe(".growing_collect_imp",e=>{if(!e.id||n[e.id])return;const t=getManualImpInfo(e.dataset),{eventId:i,properties:s}=t;i&&e.id&&!n[e.id]&&(this.growingio.observer.track(i,s),n[e.id]=!0)})}setStorageSync(e,t){wx.setStorageSync(e,JSON.stringify(t))}removeStorageSync(e){wx.removeStorageSync(e)}navigateTo(e){wx.navigateTo(e)}switchTab(e){wx.switchTab(e)}onAppShow(e){wx.onAppShow(e)}onAppHide(e){wx.onAppHide(e)}}class Config$1{constructor(e){this.growingio=e}setDataCollect(e){this.growingio.vdsConfig.dataCollect=e}enableDebug(e){e&&console&&(this.growingio.vdsConfig.debug=e)}setTrackerScheme(e){const t=(e+"").toLocaleLowerCase();"http"!==t&&"https"!==t||(this.growingio.vdsConfig.scheme=`${e}://`)}setTrackerHost(e){isString(e)&&(this.growingio.vdsConfig.host=e)}}const sdkVer="1.2";class growingio{constructor(){this.config=new Config$1(this),this.uploadingMessages=[],this.launcher=[]}init(e,t,i,n){this.start||(i&&"string"!=typeof i&&(n=i,i=void 0),i||n||(i=void 0,n={}),n.host&&t&&e||console.error("GrowingIO SDK初始化失败，请检查你的dataSourceId, projectId 和 host 是否配置正确"),"alip"===platformConfig$1.platform&&(n.vue||n.taro||n.cml||n.wepy)&&(platformConfig$1.canHook=!0),n.usePlugin&&(platformConfig$1.canHook=!1),this.vdsConfig={projectId:e,dataSourceId:t,appId:i,appVer:n.version||"",sdkVer:sdkVer,dataCollect:!0,host:n.host,gtouchHost:n.gtouchHost,scheme:n.scheme||"https://",getLocation:n.getLocation||!1,debug:n.debug,usePlugin:n.usePlugin||!1,vue:n.vue||!1,taro:n.taro||!1,cml:n.cml||!1,wepy:n.wepy||!1,getInfoHook:defineInfoHook(n.getInfoHook),followShare:void 0!==n.followShare&&n.followShare,forceLogin:n.forceLogin||!1},gioGlobal.vdsConfig=this.vdsConfig,gioGlobal.platformConfig=platformConfig$1,this.info=new Weixin(this),this.observer=new Observer(this),this.uploader=new Uploader(this),i||(this.vdsConfig.appId=this.info.getAppId()),this.setTrackerHost(n.host),this.setTrackerScheme(n.scheme),this.setDataCollect(n.dataCollect),this._start())}setConfig(e){this.init(e.projectId,e.dataSourceId,e.appId,e)}send(){this.start=!0,this.vdsConfig.dataCollect&&this.vdsConfig.host&&this.appListener()}setTrackerScheme(e){this.config.setTrackerScheme(e)}setTrackerHost(e){this.config.setTrackerHost(e)}enableDebug(e){this.config.enableDebug(e)}setDataCollect(e){this.vdsConfig.dataCollect=void 0===e||e}appListener(){this.observer.sendVisitEvent(),this.launcher.length>0&&this.launcher.map(e=>{this.observer[e[0]].apply(this.observer,e[1])})}proxy(e,t){try{if("login"==e)return;if(this[e])this[e].apply(this,t);else if(this.observer&&this.observer[e]){if(this.start||"setUserId"===e||"clearUserId"===e)return this.observer[e].apply(this.observer,t);this.launcher.push([e,t])}}catch(e){console&&console.error(e)}}login(e){if(this.vdsConfig.forceLogin){this.info.uid=e,this.vdsConfig.forceLogin=!1;for(let t of this.uploadingMessages)t.anonymousId=e,this.upload(t)}}upload(e){this.vdsConfig.dataCollect&&(this.vdsConfig.forceLogin?this.uploadingMessages.push(e):(this.vdsConfig.debug&&console.info("generate new event",JSON.stringify(e,0,2)),gioEmitter.emitEvent("upload",[e]),this.uploader.upload(e)))}_start(){this.info.onAppShow?this.info.onAppShow(e=>{this.observer.sendShareAppOpen(e),this._getOption(e),gio("send")}):gio("send"),this.info.onAppHide?this.info.onAppHide(()=>{this.info.esid=this.observer.esid,this.observer.lastSentTime=+Date.now(),this.observer.sendCloseEvent()}):this.vdsConfig.canHide=!0,this._hookPage()}_getOption(e){this.observer.currentScene=e.scene,this.observer.path=e.path,this.observer.query=e.query}_hookPage(){this.vdsConfig.taro?(this.taroRootVMs={},proxyTaro(this.vdsConfig.taro,this,this.vdsConfig)):this.vdsConfig.wepy?proxyWepy(this.vdsConfig.wepy,this,this.vdsConfig):this.vdsConfig.cml?(gioGlobal.platformConfig.hooks.Component=!1,proxyCml(this.vdsConfig.cml)):this.vdsConfig.vue&&(this.vueRootVMs={},proxyVue(this.vdsConfig.vue,this)),VdsInstrumentAgent.initInstrument(this.observer);try{gioGlobal&&platformConfig$1.canHook&&platformConfig$1.hooks.Page&&(gioGlobal.Page=Page)}catch(e){}}}function isEqual(e,t){if(typeof e!=typeof t)return!1;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e||"function"==typeof e||void 0==e||void 0==t)return Object.is(e,t);if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((e,i)=>isEqual(e,t[i]));if("[object Object]"===Object.prototype.toString.call(e)&&"[object Object]"===Object.prototype.toString.call(t)){const i=Object.keys(e),n=Object.keys(t);return!(!i.every(i=>t.hasOwnProperty(i)&&isEqual(e[i],t[i]))||!n.every(i=>e.hasOwnProperty(i)&&isEqual(t[i],e[i])))}return!1}const getParameterByName=(e,t)=>{if("string"!=typeof t)return;"?"!==t[0]&&(t="?"+t),e=e.replace(/[\[\]]/g,"\\$&");const i=RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null};class BaseUserStorage{constructor(e){this.growingio=e,this.namespace="push-user-status",this.userTagDuration=432e7,this.eventTagDuration=864e5,this.handleCs1=this.handleCs1.bind(this),this.handleClearCs1=this.handleClearCs1.bind(this)}handleCs1(e){e!==this.get("cs1")&&(this.set("cs1",e),this.set("bcs",void 0),gioEmitter.emit("cs1Refresh"))}handleClearCs1(){this.set("cs1",void 0),this.set("bcs",void 0)}setIsPreview(e){if(!e.q)return;const t=getParameterByName("scene",e.q);if(!t)return;const i=getParameterByName("gioMessageId",t);if(!i)return;const n={s:"splash",pw:"popupWindow",p:"push",b:"banner",ab:"abTest"}[getParameterByName("mt",t)]||"";gioGlobal.__growing__.marketingPreview={messageId:i,msgType:n}}storeFilters(e,t,i){const n=t(),s=this.get(n,this.eventTagDuration)||[],o=i.call(this,e),r=[...s,...o];this.set(n,r)}generateEventKey(e){return`${e}#${this.get("cs1")||""}`}_get(e){return this.growingio.info.getStorageSync(`${this.namespace}#${e}`)}getUserAttrs(){const e=this.generateEventKey("userAttrs");return this.get(e)||[]}getTriggerAttrs(){const e=this.generateEventKey("triggerAttrs");return this.get(e)||[]}set(e,t){const i=this._get(e),n=new Date;n.setHours(0),n.setMinutes(0),n.setSeconds(0);const s={startAt:n.getTime(),value:t};i&&isEqual(s.value,JSON.parse(i).value)||this.growingio.info.setStorageSync(`${this.namespace}#${e}`,s)}get(e,t=this.userTagDuration){const i=this._get(e);if(!i)return;const n=JSON.parse(i);return Date.now()>n.startAt+t?void 0:n.value}getCs1(){return this.get("cs1")}}class UserStorage extends BaseUserStorage{constructor(e){super(e),this.growingio=e,this.handleEvent=this.handleEvent.bind(this),this.addEventListener()}addEventListener(){gioEmitter.on("appOpen",this.handleEvent),gioEmitter.on("upload",this.handleEvent),gioEmitter.on("setCs1",this.handleCs1),gioEmitter.on("clearCs1",this.handleClearCs1)}handleEvent(e){if(e)switch(e.type){case"VISIT":this.storeFilters(e,this.generateEventKey.bind(this,"userAttrs"),this.formatUserFilterVars);break;case"CUSTOM_EVENT":this.storeFilters(e,this.generateEventKey.bind(this,"triggerAttrs"),this.formatEventFilterVars);case"PAGE":this.setIsPreview(e);break;default:this.storeFilters(e,this.generateEventKey.bind(this,"userAttrs"),this.formatUserFilterVars)}}formatUserFilterVars(e){const t=e.attributes;return t?Object.keys(t).map(e=>({key:e,value:t[e]})):[]}formatEventFilterVars(e){const t=e.attributes;return[{key:e.eventKey,value:"",event_variable:t?Object.keys(t).map(e=>({key:e,value:t[e]})):[]}]}}try{const e="wx";initGlobal(e),"frame"!==e&&(gioGlobal.gio__platform=e)}catch(e){}const growingio$1=new growingio;let gio=function(){let e=arguments[0];if(!e)return;let t=2>arguments.length?[]:[].slice.call(arguments,1);if("init"===e){if(gioGlobal.vdsConfig)return void console.warn("SDK已经初始化成功，请检查是否加载过其他平台sdk");if(1>t.length)return void console.log('初始化 GrowingIO SDK 失败。请使用 gio("init", "你的GrowingIO项目ID", "你的应用APP_ID", options);');growingio$1.init(t[0],t[1],t[2],t[3])}else{if("setConfig"!==e)return growingio$1.proxy(e,t);if(!t[0])return void console.log("初始化 GrowingIO SDK 失败。请检查你的config文件是否引入正确");if(!t[0].projectId)return void console.log("初始化 GrowingIO SDK 失败。请检查你的 GrowingIO项目ID, 你的应用APP_ID 是否填写正确");growingio$1.setConfig(t[0])}};console.log("init growingio...");const GioPage=VdsInstrumentAgent.GrowingPage,GioComponent=VdsInstrumentAgent.GrowingComponent,GioBehavior=VdsInstrumentAgent.GrowingBehavior,gioEmitter$1=gioEmitter,userStorage=new UserStorage(growingio$1);gioGlobal.__growing__={gioEmitter:gioEmitter$1,gio:gio,growingio:growingio$1,userStorage:userStorage,marketingPreview:void 0,entry:"cdp"},gioGlobal.gio=gio,exports.GioBehavior=GioBehavior,exports.GioComponent=GioComponent,exports.GioPage=GioPage,exports.default=gio,exports.gioEmitter=gioEmitter$1,exports.growingio=growingio$1;
